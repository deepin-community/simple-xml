Description: Applies safe default settings to the XML parsers
Origin: backport, https://github.com/dweiss/simplexml/commit/c8d4b431
Bug: https://github.com/ngallagher/simplexml/issues/18
Bug-Debian: https://bugs.debian.org/888547
--- a/src/org/simpleframework/xml/stream/DocumentProvider.java
+++ b/src/org/simpleframework/xml/stream/DocumentProvider.java
@@ -53,6 +53,16 @@
     */
    public DocumentProvider() {
       this.factory = DocumentBuilderFactory.newInstance();
+      try {
+         this.factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
+         this.factory.setFeature("http://xml.org/sax/features/external-general-entities", false);
+         this.factory.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
+         this.factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
+      } catch (javax.xml.parsers.ParserConfigurationException e) {
+         throw new RuntimeException("Security feature not supported by the XML parser", e);
+      }
+      this.factory.setXIncludeAware(false);
+      this.factory.setExpandEntityReferences(false);
       this.factory.setNamespaceAware(true);
    }
    
--- a/src/org/simpleframework/xml/stream/StreamProvider.java
+++ b/src/org/simpleframework/xml/stream/StreamProvider.java
@@ -23,6 +23,8 @@
 
 import javax.xml.stream.XMLEventReader;
 import javax.xml.stream.XMLInputFactory;
+import javax.xml.stream.XMLResolver;
+import javax.xml.stream.XMLStreamException;
 
 /**
  * The <code>StreamProvider</code> object is used to provide event
@@ -50,6 +52,15 @@
     */
    public StreamProvider() {
       this.factory = XMLInputFactory.newInstance();
+      this.factory.setProperty(XMLInputFactory.SUPPORT_DTD, false);
+      this.factory.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false);
+      this.factory.setXMLResolver(new XMLResolver() {
+         @Override
+         public Object resolveEntity(String publicID, String systemID, String baseURI, String namespace)
+             throws XMLStreamException {
+            throw new XMLStreamException("Entity resolution disabled by default.");
+         }
+      });
    }
 
    /**
@@ -91,4 +102,4 @@
    private EventReader provide(XMLEventReader source) throws Exception {
       return new StreamReader(source);
    }
-}
\ No newline at end of file
+}
